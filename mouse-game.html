<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¼ æ ‡ç»ƒä¹ æ¸¸æˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        .game-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 1200px;
            width: 95%;
            min-height: 600px;
            position: relative;
        }

        .menu-screen {
            text-align: center;
        }

        h1 {
            color: #667eea;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .difficulty-selector {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .difficulty-btn {
            padding: 15px 30px;
            font-size: 1.2em;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            color: white;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .difficulty-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .difficulty-btn.easy {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .difficulty-btn.medium {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .difficulty-btn.hard {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }

        .time-selector {
            margin: 30px 0;
        }

        .time-selector label {
            display: block;
            margin-bottom: 10px;
            color: #333;
            font-size: 1.1em;
            font-weight: bold;
        }

        .time-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .time-btn {
            padding: 10px 20px;
            font-size: 1em;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .time-btn:hover,
        .time-btn.active {
            background: #667eea;
            color: white;
        }

        .game-screen {
            display: none;
            position: relative;
            width: 100%;
            height: 600px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            overflow: hidden;
        }

        .game-info {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            z-index: 10;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .info-item {
            text-align: center;
        }

        .info-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
        }

        .target {
            position: absolute;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.2s ease-out;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2em;
            user-select: none;
            /* 3Dæ•ˆæœ */
            transform-style: preserve-3d;
            perspective: 1000px;
            /* å¹³æ»‘ç§»åŠ¨ */
            will-change: transform, left, top;
            /* æ–‡å­—é˜´å½±ï¼Œç¡®ä¿åœ¨3Dçƒä½“ä¸Šæ¸…æ™°å¯è§ */
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5), 0 0 8px rgba(0, 0, 0, 0.3);
            z-index: 1;
        }

        /* 3Dçƒä½“æ•ˆæœ - ä½¿ç”¨ä¼ªå…ƒç´ åˆ›å»ºé«˜å…‰ */
        .target::before {
            content: '';
            position: absolute;
            top: 15%;
            left: 25%;
            width: 35%;
            height: 35%;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.6) 0%, transparent 70%);
            pointer-events: none;
            z-index: 0;
        }

        .target::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: inherit;
            filter: blur(2px);
            opacity: 0.3;
            z-index: -1;
            transform: translateZ(-10px);
        }

        .target:hover {
            transform: scale(1.15) rotateY(15deg) rotateX(15deg);
        }

        /* å•å‡»ç›®æ ‡ - ç»¿è‰²3Dçƒ */
        .target.click {
            background: radial-gradient(circle at 30% 30%, #38ef7d 0%, #11998e 50%, #0d7a6b 100%);
            box-shadow:
                0 10px 30px rgba(17, 153, 142, 0.4),
                0 5px 15px rgba(17, 153, 142, 0.3),
                inset 0 -5px 20px rgba(13, 122, 107, 0.5),
                inset 0 5px 20px rgba(56, 239, 125, 0.3);
        }

        /* åŒå‡»ç›®æ ‡ - ç²‰è‰²3Dçƒ */
        .target.double-click {
            background: radial-gradient(circle at 30% 30%, #f5576c 0%, #f093fb 50%, #c471ed 100%);
            box-shadow:
                0 10px 30px rgba(240, 147, 251, 0.4),
                0 5px 15px rgba(240, 147, 251, 0.3),
                inset 0 -5px 20px rgba(196, 113, 237, 0.5),
                inset 0 5px 20px rgba(245, 87, 108, 0.3);
        }

        /* ç§»åŠ¨ç›®æ ‡ - è“è‰²3Dçƒ */
        .target.move {
            background: radial-gradient(circle at 30% 30%, #00f2fe 0%, #4facfe 50%, #3a7bd5 100%);
            box-shadow:
                0 10px 30px rgba(79, 172, 254, 0.4),
                0 5px 15px rgba(79, 172, 254, 0.3),
                inset 0 -5px 20px rgba(58, 123, 213, 0.5),
                inset 0 5px 20px rgba(0, 242, 254, 0.3);
            /* ç§»åŠ¨ç›®æ ‡ä½¿ç”¨å¹³æ»‘çš„CSS transition */
            transition: left 0.6s cubic-bezier(0.4, 0, 0.2, 1),
                top 0.6s cubic-bezier(0.4, 0, 0.2, 1),
                transform 0.2s ease-out;
        }

        /* ç§»åŠ¨ç›®æ ‡çš„åŠ¨ç”»æ•ˆæœ */
        .target.move.animating {
            animation: float 2s ease-in-out infinite;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0px) rotateY(0deg);
            }

            50% {
                transform: translateY(-5px) rotateY(10deg);
            }
        }

        /* ç›®æ ‡å‡ºç°æ—¶çš„3DåŠ¨ç”» */
        .target {
            animation: appear3D 0.5s ease-out;
        }

        @keyframes appear3D {
            0% {
                transform: scale(0) rotateY(180deg) rotateX(90deg);
                opacity: 0;
            }

            50% {
                transform: scale(1.1) rotateY(90deg) rotateX(45deg);
            }

            100% {
                transform: scale(1) rotateY(0deg) rotateX(0deg);
                opacity: 1;
            }
        }

        .game-over-screen {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .final-score {
            font-size: 3em;
            color: #667eea;
            margin: 20px 0;
            font-weight: bold;
        }

        .restart-btn {
            padding: 15px 40px;
            font-size: 1.2em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s;
        }

        .restart-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .particle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #667eea;
            border-radius: 50%;
            pointer-events: none;
            animation: particle-anim 0.6s ease-out forwards;
        }

        @keyframes particle-anim {
            0% {
                transform: scale(1);
                opacity: 1;
            }

            100% {
                transform: scale(0) translateY(-50px);
                opacity: 0;
            }
        }

        .combo-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3em;
            font-weight: bold;
            color: #667eea;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 100;
        }

        .combo-indicator.show {
            opacity: 1;
            animation: combo-pop 0.5s ease-out;
        }

        @keyframes combo-pop {
            0% {
                transform: translate(-50%, -50%) scale(0.5);
            }

            50% {
                transform: translate(-50%, -50%) scale(1.2);
            }

            100% {
                transform: translate(-50%, -50%) scale(1);
            }
        }
    </style>
</head>

<body>
    <div class="game-container">
        <!-- èœå•ç•Œé¢ -->
        <div class="menu-screen" id="menuScreen">
            <h1>ğŸ¯ é¼ æ ‡ç»ƒä¹ æ¸¸æˆ</h1>
            <div class="difficulty-selector">
                <button class="difficulty-btn easy" data-difficulty="easy">åˆçº§</button>
                <button class="difficulty-btn medium" data-difficulty="medium">ä¸­çº§</button>
                <button class="difficulty-btn hard" data-difficulty="hard">é«˜çº§</button>
            </div>
            <div class="time-selector">
                <label>é€‰æ‹©æ¸¸æˆæ—¶é•¿ï¼š</label>
                <div class="time-buttons">
                    <button class="time-btn" data-time="60">1åˆ†é’Ÿ</button>
                    <button class="time-btn" data-time="120">2åˆ†é’Ÿ</button>
                    <button class="time-btn" data-time="180">3åˆ†é’Ÿ</button>
                    <button class="time-btn" data-time="300">5åˆ†é’Ÿ</button>
                </div>
            </div>
        </div>

        <!-- æ¸¸æˆç•Œé¢ -->
        <div class="game-screen" id="gameScreen">
            <div class="game-info">
                <div class="info-item">
                    <div class="info-label">æ—¶é—´</div>
                    <div class="info-value" id="timeLeft">00:00</div>
                </div>
                <div class="info-item">
                    <div class="info-label">åˆ†æ•°</div>
                    <div class="info-value" id="score">0</div>
                </div>
                <div class="info-item">
                    <div class="info-label">è¿å‡»</div>
                    <div class="info-value" id="combo">0</div>
                </div>
                <div class="info-item">
                    <div class="info-label">å‡†ç¡®ç‡</div>
                    <div class="info-value" id="accuracy">100%</div>
                </div>
            </div>
            <div class="combo-indicator" id="comboIndicator"></div>
        </div>

        <!-- æ¸¸æˆç»“æŸç•Œé¢ -->
        <div class="game-over-screen" id="gameOverScreen">
            <h1>æ¸¸æˆç»“æŸï¼</h1>
            <div class="final-score" id="finalScore">0</div>
            <p style="font-size: 1.2em; color: #666; margin: 20px 0;">
                æ€»åˆ†æ•°ï¼š<span id="totalScore">0</span> |
                å‡†ç¡®ç‡ï¼š<span id="finalAccuracy">0%</span> |
                æœ€é«˜è¿å‡»ï¼š<span id="maxCombo">0</span>
            </p>
            <button class="restart-btn" onclick="restartGame()">å†æ¥ä¸€å±€</button>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            difficulty: 'easy',
            timeLimit: 60,
            timeLeft: 0,
            score: 0,
            combo: 0,
            maxCombo: 0,
            hits: 0,
            misses: 0,
            targets: [],
            gameInterval: null,
            timeInterval: null,
            isPlaying: false
        };

        // éš¾åº¦é…ç½®
        const difficultyConfig = {
            easy: {
                spawnRate: 2000,      // æ¯2ç§’ç”Ÿæˆä¸€ä¸ªç›®æ ‡
                targetSize: 80,       // ç›®æ ‡å¤§å°
                targetLifetime: 4000, // ç›®æ ‡å­˜åœ¨æ—¶é—´4ç§’
                moveSpeed: 1,         // ç§»åŠ¨é€Ÿåº¦
                clickPoints: 10,      // å•å‡»å¾—åˆ†
                doubleClickPoints: 20, // åŒå‡»å¾—åˆ†
                movePoints: 5         // ç§»åŠ¨å¾—åˆ†
            },
            medium: {
                spawnRate: 1500,
                targetSize: 60,
                targetLifetime: 3000,
                moveSpeed: 1.5,
                clickPoints: 15,
                doubleClickPoints: 30,
                movePoints: 8
            },
            hard: {
                spawnRate: 1000,
                targetSize: 50,
                targetLifetime: 2000,
                moveSpeed: 2,
                clickPoints: 20,
                doubleClickPoints: 40,
                movePoints: 10
            }
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function () {
            // éš¾åº¦é€‰æ‹©
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    gameState.difficulty = this.dataset.difficulty;
                });
            });

            // æ—¶é—´é€‰æ‹©
            document.querySelectorAll('.time-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    gameState.timeLimit = parseInt(this.dataset.time);
                });
            });

            // é»˜è®¤é€‰æ‹©åˆçº§å’Œ1åˆ†é’Ÿ
            document.querySelector('.difficulty-btn.easy').classList.add('active');
            document.querySelector('.time-btn[data-time="60"]').classList.add('active');
        });

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            if (!gameState.difficulty || !gameState.timeLimit) {
                alert('è¯·é€‰æ‹©éš¾åº¦å’Œæ¸¸æˆæ—¶é•¿ï¼');
                return;
            }

            // é‡ç½®æ¸¸æˆçŠ¶æ€
            gameState.timeLeft = gameState.timeLimit;
            gameState.score = 0;
            gameState.combo = 0;
            gameState.maxCombo = 0;
            gameState.hits = 0;
            gameState.misses = 0;
            gameState.targets = [];
            gameState.isPlaying = true;

            // åˆ‡æ¢ç•Œé¢
            document.getElementById('menuScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';
            document.getElementById('gameOverScreen').style.display = 'none';

            // æ¸…ç©ºæ‰€æœ‰ç›®æ ‡
            document.querySelectorAll('.target').forEach(t => t.remove());

            // æ›´æ–°æ˜¾ç¤º
            updateDisplay();

            // å¼€å§‹è®¡æ—¶
            gameState.timeInterval = setInterval(() => {
                gameState.timeLeft--;
                updateDisplay();

                if (gameState.timeLeft <= 0) {
                    endGame();
                }
            }, 1000);

            // å¼€å§‹ç”Ÿæˆç›®æ ‡
            const config = difficultyConfig[gameState.difficulty];
            spawnTarget();
            gameState.gameInterval = setInterval(() => {
                if (gameState.isPlaying) {
                    spawnTarget();
                }
            }, config.spawnRate);
        }

        // ç”Ÿæˆç›®æ ‡
        function spawnTarget() {
            const gameScreen = document.getElementById('gameScreen');
            const config = difficultyConfig[gameState.difficulty];

            // éšæœºé€‰æ‹©ç›®æ ‡ç±»å‹
            const types = ['click', 'double-click', 'move'];
            const type = types[Math.floor(Math.random() * types.length)];

            const target = document.createElement('div');
            target.className = `target ${type}`;

            // è®¾ç½®å¤§å°
            const size = config.targetSize;
            target.style.width = size + 'px';
            target.style.height = size + 'px';

            // éšæœºä½ç½®ï¼ˆé¿å¼€è¾¹ç¼˜ï¼‰
            const padding = 50;
            const maxX = gameScreen.offsetWidth - size - padding;
            const maxY = gameScreen.offsetHeight - size - padding;
            let x = Math.random() * maxX + padding;
            let y = Math.random() * maxY + padding;

            target.style.left = x + 'px';
            target.style.top = y + 'px';

            // è®¾ç½®æ–‡æœ¬
            if (type === 'click') {
                target.textContent = 'å•å‡»';
            } else if (type === 'double-click') {
                target.textContent = 'åŒå‡»';
            } else {
                target.textContent = 'ç§»åŠ¨';
            }

            // æ·»åŠ åˆ°æ¸¸æˆåŒºåŸŸ
            gameScreen.appendChild(target);

            // å­˜å‚¨ç›®æ ‡ä¿¡æ¯
            const targetInfo = {
                element: target,
                type: type,
                x: x,
                y: y,
                createdAt: Date.now(),
                clicked: false,
                moveInterval: null
            };

            gameState.targets.push(targetInfo);

            // å¦‚æœæ˜¯ç§»åŠ¨ç±»å‹ï¼Œè®©ç›®æ ‡ç§»åŠ¨ - ä½¿ç”¨å¹³æ»‘åŠ¨ç”»
            if (type === 'move') {
                target.classList.add('animating');

                // ä½¿ç”¨ requestAnimationFrame å®ç°å¹³æ»‘ç§»åŠ¨
                let animationId = null;
                let startX = x;
                let startY = y;
                let targetX = x;
                let targetY = y;
                let startTime = Date.now();
                const moveDuration = 2000 / config.moveSpeed; // æ ¹æ®éš¾åº¦è°ƒæ•´ç§»åŠ¨æ—¶é—´

                function animateMove() {
                    if (targetInfo.clicked || !gameState.isPlaying) {
                        if (animationId) {
                            cancelAnimationFrame(animationId);
                        }
                        return;
                    }

                    const currentTime = Date.now();
                    const elapsed = currentTime - startTime;
                    const progress = Math.min(elapsed / moveDuration, 1);

                    // ä½¿ç”¨ç¼“åŠ¨å‡½æ•°å®ç°å¹³æ»‘ç§»åŠ¨
                    const easeProgress = easeInOutCubic(progress);
                    const currentX = startX + (targetX - startX) * easeProgress;
                    const currentY = startY + (targetY - startY) * easeProgress;

                    target.style.left = currentX + 'px';
                    target.style.top = currentY + 'px';
                    targetInfo.x = currentX;
                    targetInfo.y = currentY;

                    if (progress >= 1) {
                        // åˆ°è¾¾ç›®æ ‡ä½ç½®ï¼Œè®¾ç½®æ–°çš„ç›®æ ‡
                        startX = targetX;
                        startY = targetY;
                        targetX = Math.random() * maxX + padding;
                        targetY = Math.random() * maxY + padding;
                        startTime = Date.now();
                    }

                    animationId = requestAnimationFrame(animateMove);
                }

                // åˆå§‹åŒ–ç¬¬ä¸€ä¸ªç›®æ ‡ä½ç½®
                targetX = Math.random() * maxX + padding;
                targetY = Math.random() * maxY + padding;
                startTime = Date.now();
                animationId = requestAnimationFrame(animateMove);
                targetInfo.animationId = animationId;
            }

            // è®¾ç½®ç‚¹å‡»äº‹ä»¶
            let clickCount = 0;
            let clickTimer = null;

            target.addEventListener('click', function (e) {
                e.stopPropagation();
                clickCount++;

                if (type === 'double-click') {
                    if (clickCount === 1) {
                        clickTimer = setTimeout(() => {
                            clickCount = 0;
                        }, 300);
                    } else if (clickCount === 2) {
                        clearTimeout(clickTimer);
                        handleTargetHit(targetInfo);
                    }
                } else if (type === 'click') {
                    handleTargetHit(targetInfo);
                }
            });

            // ç§»åŠ¨ç±»å‹ï¼šé¼ æ ‡ç§»åŠ¨åˆ°ç›®æ ‡ä¸Šå³å¯å¾—åˆ†
            if (type === 'move') {
                target.addEventListener('mouseenter', function () {
                    if (!targetInfo.clicked) {
                        handleTargetHit(targetInfo);
                    }
                });
            }

            // è‡ªåŠ¨ç§»é™¤ç›®æ ‡
            setTimeout(() => {
                if (!targetInfo.clicked) {
                    removeTarget(targetInfo, false);
                }
            }, config.targetLifetime);
        }

        // å¤„ç†ç›®æ ‡å‘½ä¸­
        function handleTargetHit(targetInfo) {
            if (targetInfo.clicked) return;

            targetInfo.clicked = true;
            gameState.hits++;
            gameState.combo++;

            if (gameState.combo > gameState.maxCombo) {
                gameState.maxCombo = gameState.combo;
            }

            // è®¡ç®—å¾—åˆ†
            const config = difficultyConfig[gameState.difficulty];
            let points = 0;
            const timeElapsed = Date.now() - targetInfo.createdAt;
            const timeBonus = Math.max(0, config.targetLifetime - timeElapsed) / config.targetLifetime;

            if (targetInfo.type === 'click') {
                points = Math.floor(config.clickPoints * (1 + timeBonus * 0.5));
            } else if (targetInfo.type === 'double-click') {
                points = Math.floor(config.doubleClickPoints * (1 + timeBonus * 0.5));
            } else {
                points = Math.floor(config.movePoints * (1 + timeBonus * 0.5));
            }

            // è¿å‡»åŠ æˆ
            if (gameState.combo > 5) {
                points = Math.floor(points * (1 + (gameState.combo - 5) * 0.1));
            }

            gameState.score += points;

            // æ˜¾ç¤ºè¿å‡»æ•ˆæœ
            if (gameState.combo >= 5) {
                showComboIndicator(gameState.combo);
            }

            // åˆ›å»ºç²’å­æ•ˆæœ
            createParticles(targetInfo.x + targetInfo.element.offsetWidth / 2,
                targetInfo.y + targetInfo.element.offsetHeight / 2);

            // ç§»é™¤ç›®æ ‡
            removeTarget(targetInfo, true);
            updateDisplay();
        }

        // ç¼“åŠ¨å‡½æ•° - å®ç°å¹³æ»‘çš„åŠ¨ç”»æ•ˆæœ
        function easeInOutCubic(t) {
            return t < 0.5
                ? 4 * t * t * t
                : 1 - Math.pow(-2 * t + 2, 3) / 2;
        }

        // ç§»é™¤ç›®æ ‡
        function removeTarget(targetInfo, hit) {
            if (!hit) {
                gameState.misses++;
                gameState.combo = 0;
            }

            // å–æ¶ˆç§»åŠ¨åŠ¨ç”»
            if (targetInfo.moveInterval) {
                clearInterval(targetInfo.moveInterval);
            }
            if (targetInfo.animationId) {
                cancelAnimationFrame(targetInfo.animationId);
            }

            targetInfo.element.style.transition = 'all 0.3s';
            targetInfo.element.style.transform = 'scale(0) rotateY(180deg)';
            targetInfo.element.style.opacity = '0';

            setTimeout(() => {
                if (targetInfo.element.parentNode) {
                    targetInfo.element.remove();
                }
            }, 300);

            // ä»æ•°ç»„ä¸­ç§»é™¤
            const index = gameState.targets.indexOf(targetInfo);
            if (index > -1) {
                gameState.targets.splice(index, 1);
            }
        }

        // åˆ›å»ºç²’å­æ•ˆæœ
        function createParticles(x, y) {
            for (let i = 0; i < 8; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                particle.style.background = `hsl(${Math.random() * 360}, 70%, 60%)`;

                const angle = (Math.PI * 2 * i) / 8;
                const velocity = 30 + Math.random() * 20;
                particle.style.setProperty('--dx', Math.cos(angle) * velocity + 'px');
                particle.style.setProperty('--dy', Math.sin(angle) * velocity + 'px');

                document.getElementById('gameScreen').appendChild(particle);

                setTimeout(() => {
                    particle.remove();
                }, 600);
            }
        }

        // æ˜¾ç¤ºè¿å‡»æŒ‡ç¤ºå™¨
        function showComboIndicator(combo) {
            const indicator = document.getElementById('comboIndicator');
            indicator.textContent = `${combo} è¿å‡»ï¼`;
            indicator.classList.add('show');

            setTimeout(() => {
                indicator.classList.remove('show');
            }, 500);
        }

        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            const minutes = Math.floor(gameState.timeLeft / 60);
            const seconds = gameState.timeLeft % 60;
            document.getElementById('timeLeft').textContent =
                `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;

            document.getElementById('score').textContent = gameState.score;
            document.getElementById('combo').textContent = gameState.combo;

            const total = gameState.hits + gameState.misses;
            const accuracy = total > 0 ? Math.round((gameState.hits / total) * 100) : 100;
            document.getElementById('accuracy').textContent = accuracy + '%';
        }

        // ç»“æŸæ¸¸æˆ
        function endGame() {
            gameState.isPlaying = false;

            if (gameState.timeInterval) {
                clearInterval(gameState.timeInterval);
            }
            if (gameState.gameInterval) {
                clearInterval(gameState.gameInterval);
            }

            // æ¸…é™¤æ‰€æœ‰ç›®æ ‡
            gameState.targets.forEach(target => {
                if (target.moveInterval) {
                    clearInterval(target.moveInterval);
                }
                if (target.animationId) {
                    cancelAnimationFrame(target.animationId);
                }
                target.element.remove();
            });
            gameState.targets = [];

            // æ˜¾ç¤ºç»“æœ
            const total = gameState.hits + gameState.misses;
            const accuracy = total > 0 ? Math.round((gameState.hits / total) * 100) : 0;

            document.getElementById('finalScore').textContent = gameState.score;
            document.getElementById('totalScore').textContent = gameState.score;
            document.getElementById('finalAccuracy').textContent = accuracy + '%';
            document.getElementById('maxCombo').textContent = gameState.maxCombo;

            // åˆ‡æ¢ç•Œé¢
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('gameOverScreen').style.display = 'block';
        }

        // é‡æ–°å¼€å§‹æ¸¸æˆ
        function restartGame() {
            document.getElementById('gameOverScreen').style.display = 'none';
            document.getElementById('menuScreen').style.display = 'block';
        }

        // ç‚¹å‡»éš¾åº¦æŒ‰é’®æ—¶è‡ªåŠ¨å¼€å§‹æ¸¸æˆ
        document.querySelectorAll('.difficulty-btn').forEach(btn => {
            btn.addEventListener('click', function () {
                setTimeout(() => {
                    if (document.querySelector('.time-btn.active')) {
                        startGame();
                    }
                }, 100);
            });
        });

        // ç‚¹å‡»æ—¶é—´æŒ‰é’®æ—¶è‡ªåŠ¨å¼€å§‹æ¸¸æˆ
        document.querySelectorAll('.time-btn').forEach(btn => {
            btn.addEventListener('click', function () {
                setTimeout(() => {
                    if (document.querySelector('.difficulty-btn.active')) {
                        startGame();
                    }
                }, 100);
            });
        });
    </script>
</body>

</html>